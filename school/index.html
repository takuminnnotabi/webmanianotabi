<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™‚é–“å‰²è¡¨ç¤ºæ¿</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;500;700;800;900&family=Noto+Sans+JP:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-green: #00b140;
            --primary-orange: #f5a623;
            --primary-yellow: #c8e038;
            --dark-bg: #3d3d3d;
            --darker-bg: #2d2d2d;
            --danger: #e74c3c;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html, body {
            font-family: 'M PLUS Rounded 1c', 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
        }
        
        /* Fullscreen */
        body.fullscreen-mode { background: var(--dark-bg) !important; overflow: hidden !important; }
        body.fullscreen-mode .editor-container { display: none !important; }
        body.fullscreen-mode .fullscreen-board-container { display: flex !important; }
        
        .fullscreen-board-container {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            background: var(--dark-bg);
            z-index: 9999;
        }
        
        .fullscreen-board {
            width: 100%; height: 100%;
            display: flex; flex-direction: column;
            background: var(--dark-bg);
        }
        
        /* Editor */
        .editor-container {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .page-title {
            color: #fff;
            font-size: 24px;
            font-weight: 800;
        }
        
        .page-title span {
            background: linear-gradient(90deg, var(--primary-orange), var(--primary-yellow));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .fullscreen-btn {
            padding: 14px 28px;
            background: linear-gradient(135deg, var(--primary-green), #008830);
            color: #fff;
            border: none;
            border-radius: 30px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            font-family: inherit;
        }
        
        /* Tabs */
        .main-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .main-tab {
            padding: 12px 24px;
            background: rgba(255,255,255,0.1);
            color: #fff;
            border: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-size: 14px;
            font-weight: 700;
            font-family: inherit;
        }
        
        .main-tab.active {
            background: rgba(255,255,255,0.98);
            color: #333;
        }
        
        .tab-content {
            display: none;
            background: rgba(255,255,255,0.98);
            border-radius: 0 12px 12px 12px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        
        .tab-content.active { display: block; }
        
        .section-title {
            font-size: 16px;
            font-weight: 700;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }
        
        .editor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .form-group label {
            font-size: 12px;
            font-weight: 600;
            color: #666;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-green);
        }
        
        .form-group textarea { resize: vertical; min-height: 60px; }
        
        /* Day Tabs */
        .day-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .day-tab {
            padding: 10px 20px;
            background: #e8e8e8;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 700;
            font-family: inherit;
        }
        
        .day-tab.active { background: var(--primary-orange); color: #000; }
        
        /* Schedule Type Tabs */
        .schedule-type-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .schedule-type-tab {
            padding: 8px 16px;
            background: #d0d0d0;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            font-family: inherit;
        }
        
        .schedule-type-tab.active { background: var(--primary-green); color: #fff; }
        
        /* Period List */
        .period-list { display: flex; flex-direction: column; gap: 8px; }
        
        .period-item {
            display: grid;
            grid-template-columns: 90px 75px 75px 1fr 1fr 36px;
            gap: 8px;
            align-items: center;
            padding: 10px;
            background: #f8f8f8;
            border-radius: 8px;
        }
        
        .period-item input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 13px;
            font-family: inherit;
        }
        
        .period-item .label-input {
            font-weight: 700;
            text-align: center;
            background: var(--primary-orange);
            color: #000;
        }
        
        .delete-btn {
            width: 30px; height: 30px;
            border: none; border-radius: 50%;
            background: var(--danger);
            color: #fff;
            font-size: 16px;
            cursor: pointer;
        }
        
        .add-btn {
            padding: 10px 20px;
            background: var(--primary-green);
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            font-family: inherit;
            margin-top: 10px;
        }
        
        /* Holiday List */
        .holiday-item {
            display: grid;
            grid-template-columns: auto 120px 120px 1fr 36px;
            gap: 10px;
            align-items: center;
            padding: 12px;
            background: #f8f8f8;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .holiday-item input[type="checkbox"] {
            width: 20px; height: 20px;
        }
        
        .holiday-item input[type="date"],
        .holiday-item input[type="text"] {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: inherit;
        }
        
        /* Button Row */
        .button-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            font-family: inherit;
        }
        
        .btn-save { background: var(--primary-green); color: #fff; }
        .btn-load { background: var(--primary-orange); color: #000; }
        .btn-reset { background: var(--danger); color: #fff; }
        
        .preview-label {
            color: #fff;
            font-size: 14px;
            margin: 20px 0 10px;
            opacity: 0.7;
        }
        
        /* Board Preview */
        .board-preview {
            width: 100%;
            max-width: 1100px;
            margin: 0 auto;
            background: var(--dark-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 15px 50px rgba(0,0,0,0.5);
        }
        
        /* ===== BOARD STYLES ===== */
        .board-header {
            display: flex;
            align-items: center;
            padding: 15px 25px;
            background: var(--dark-bg);
            gap: 25px;
            flex-wrap: wrap;
        }
        
        .train-type-badge {
            background: linear-gradient(180deg, #d4e830 0%, #a8c020 100%);
            color: #000;
            font-size: 38px;
            font-weight: 900;
            padding: 10px 25px;
            letter-spacing: 0.2em;
            border-radius: 6px;
        }
        
        .next-label {
            color: #fff;
            font-size: 28px;
            font-weight: 700;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-left: auto;
        }
        
        .time-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .time-label {
            color: #fff;
            font-size: 22px;
            font-weight: 500;
        }
        
        .time-value {
            background: #fff;
            color: #000;
            font-size: 32px;
            font-weight: 700;
            padding: 8px 20px;
            border-radius: 6px;
            font-family: 'Consolas', monospace;
            min-width: 110px;
            text-align: center;
        }
        
        .class-badge {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .class-number-box {
            background: #fff;
            border: 4px solid var(--primary-green);
            border-radius: 6px;
            padding: 5px 15px;
        }
        
        .class-number-value {
            color: var(--primary-green);
            font-size: 42px;
            font-weight: 900;
            line-height: 1;
        }
        
        .class-unit {
            color: #fff;
            font-size: 18px;
            font-weight: 700;
            margin-top: 2px;
        }
        
        /* Main Display */
        .main-display {
            display: flex;
            background: var(--darker-bg);
            border-top: 3px solid #555;
            min-height: 150px;
        }
        
        .day-section {
            background: linear-gradient(180deg, #f5a623 0%, #e08a10 100%);
            padding: 20px 30px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-width: 140px;
        }
        
        .day-display {
            color: #000;
            font-size: 52px;
            font-weight: 900;
            letter-spacing: 0.15em;
        }
        
        .schedule-type-display {
            color: #6b0000;
            font-size: 20px;
            font-weight: 800;
            margin-top: 5px;
        }
        
        .current-period-section {
            flex: 1;
            display: flex;
            align-items: center;
            padding: 25px 35px;
            gap: 25px;
        }
        
        .period-indicator {
            width: 85px; height: 85px;
            border: 6px solid var(--primary-green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fff;
            flex-shrink: 0;
        }
        
        .period-indicator-text {
            color: #000;
            font-size: 45px;
            font-weight: 900;
        }
        
        .current-subject {
            color: #fff;
            font-size: 80px;
            font-weight: 900;
            letter-spacing: 0.03em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        /* Break Timer */
        .break-timer-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            padding: 20px;
        }
        
        .break-timer-label {
            color: #aaa;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .break-timer {
            color: #fff;
            font-size: 100px;
            font-weight: 900;
            font-family: 'Consolas', monospace;
            text-shadow: 0 0 20px rgba(255,255,255,0.3);
        }
        
        .break-timer.urgent {
            color: #ff6b6b;
            animation: timerPulse 0.5s ease-in-out infinite;
        }
        
        @keyframes timerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .break-next-subject {
            color: #aaa;
            font-size: 20px;
            font-weight: 600;
            margin-top: 15px;
        }
        
        /* Schedule Grid */
        .schedule-grid-section {
            background: #fff;
            padding: 18px 25px 8px;
        }
        
        .schedule-grid {
            display: flex;
            gap: 8px;
            text-align: center;
        }
        
        .schedule-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100px;
            min-width: 70px;
            flex: 1;
            padding: 5px;
        }
        
        .schedule-item.hr-slot {
            min-width: 55px;
            flex: 0 0 55px;
        }
        
        .schedule-item .subject-char {
            font-size: 28px;
            font-weight: 800;
            color: #000;
            line-height: 1.15;
        }
        
        .schedule-item.hr-slot .subject-char { font-size: 24px; }
        
        /* Timeline */
        .timeline-section {
            background: #fff;
            padding: 5px 25px 12px;
        }
        
        .timeline {
            display: flex;
            gap: 8px;
            position: relative;
            align-items: center;
            height: 50px;
        }
        
        .timeline-track {
            position: absolute;
            top: 50%; left: 28px; right: 28px;
            height: 14px;
            background: var(--primary-orange);
            transform: translateY(-50%);
            border-radius: 7px;
            z-index: 0;
            overflow: hidden;
        }
        
        .progress-fill {
            position: absolute;
            top: 0; left: 0;
            height: 100%;
            background: linear-gradient(90deg, var(--primary-green) 0%, #00d050 100%);
            border-radius: 7px;
            transition: width 1s ease;
        }
        
        .timeline-marker {
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 70px;
            flex: 1;
            position: relative;
            z-index: 1;
        }
        
        .timeline-marker.hr-slot {
            min-width: 55px;
            flex: 0 0 55px;
        }
        
        .timeline-dot {
            width: 28px; height: 28px;
            background: #fff;
            border: 5px solid var(--primary-green);
            border-radius: 50%;
        }
        
        .timeline-dot.filled { background: var(--primary-green); }
        
        .period-circle {
            min-width: 38px; height: 38px;
            padding: 0 8px;
            background: #fff;
            border: 3px solid #333;
            border-radius: 19px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 800;
        }
        
        .period-circle.active {
            background: var(--primary-green);
            color: #fff;
            border-color: var(--primary-green);
            transform: scale(1.15);
        }
        
        .period-circle.passed {
            background: var(--primary-green);
            color: #fff;
            border-color: var(--primary-green);
        }
        
        /* Room Info */
        .room-info-section {
            background: #fff;
            padding: 5px 25px 18px;
        }
        
        .room-grid {
            display: flex;
            gap: 8px;
            font-size: 12px;
            font-weight: 500;
            color: #555;
        }
        
        .room-grid span {
            text-align: center;
            min-width: 70px;
            flex: 1;
        }
        
        .room-grid span.hr-slot {
            min-width: 55px;
            flex: 0 0 55px;
        }
        
        /* Announcement Ticker */
        .announcement-section {
            background: #222;
            padding: 12px 25px;
            overflow: hidden;
        }
        
        .announcement-ticker {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .announcement-label {
            background: var(--danger);
            color: #fff;
            padding: 5px 12px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 700;
            flex-shrink: 0;
        }
        
        .announcement-text {
            color: #fff;
            font-size: 18px;
            font-weight: 600;
            white-space: nowrap;
            animation: ticker 20s linear infinite;
        }
        
        @keyframes ticker {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        
        /* Footer */
        .board-footer {
            background: #f0f0f0;
            padding: 14px 25px;
            text-align: center;
            border-top: 2px solid #ddd;
        }
        
        .footer-message {
            color: #c00;
            font-size: 15px;
            font-weight: 600;
        }
        
        /* Holiday/End Display */
        .special-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            flex: 1;
        }
        
        .special-title {
            font-size: 90px;
            font-weight: 900;
            color: #fff;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .special-message {
            font-size: 32px;
            font-weight: 700;
            color: #aaa;
            text-align: center;
            line-height: 1.5;
        }
        
        /* ===== FULLSCREEN SIZES ===== */
        .fullscreen-board .board-header { padding: 2vh 3vw; }
        .fullscreen-board .train-type-badge { font-size: 5vh; padding: 1.5vh 3vw; }
        .fullscreen-board .next-label { font-size: 4vh; }
        .fullscreen-board .time-label { font-size: 3vh; }
        .fullscreen-board .time-value { font-size: 5vh; padding: 1.5vh 2.5vw; }
        .fullscreen-board .class-number-value { font-size: 6vh; }
        .fullscreen-board .class-unit { font-size: 2.5vh; }
        .fullscreen-board .main-display { flex: 1; min-height: 0; }
        .fullscreen-board .day-section { min-width: 15vw; padding: 2vh 2vw; }
        .fullscreen-board .day-display { font-size: 8vh; }
        .fullscreen-board .schedule-type-display { font-size: 3vh; }
        .fullscreen-board .current-period-section { padding: 3vh 4vw; gap: 3vw; }
        .fullscreen-board .period-indicator { width: 12vh; height: 12vh; }
        .fullscreen-board .period-indicator-text { font-size: 7vh; }
        .fullscreen-board .current-subject { font-size: 12vh; }
        .fullscreen-board .break-timer { font-size: 15vh; }
        .fullscreen-board .break-timer-label { font-size: 4vh; }
        .fullscreen-board .break-next-subject { font-size: 3vh; }
        .fullscreen-board .schedule-grid-section { padding: 2vh 3vw 1vh; }
        .fullscreen-board .schedule-item { min-height: 14vh; }
        .fullscreen-board .schedule-item .subject-char { font-size: 4vh; }
        .fullscreen-board .timeline-section { padding: 1vh 3vw 2vh; }
        .fullscreen-board .timeline { height: 7vh; }
        .fullscreen-board .timeline-track { height: 2vh; }
        .fullscreen-board .timeline-dot { width: 4vh; height: 4vh; }
        .fullscreen-board .period-circle { min-width: 5vh; height: 5vh; font-size: 2.5vh; }
        .fullscreen-board .room-info-section { padding: 1vh 3vw 2vh; }
        .fullscreen-board .room-grid { font-size: 2vh; }
        .fullscreen-board .announcement-section { padding: 1.5vh 3vw; }
        .fullscreen-board .announcement-label { font-size: 2vh; }
        .fullscreen-board .announcement-text { font-size: 2.5vh; }
        .fullscreen-board .board-footer { padding: 2vh 3vw; }
        .fullscreen-board .footer-message { font-size: 2.5vh; }
        .fullscreen-board .special-title { font-size: 15vh; }
        .fullscreen-board .special-message { font-size: 5vh; }
        
        @media (max-width: 900px) {
            .period-item { grid-template-columns: 1fr 1fr 1fr; }
            .holiday-item { grid-template-columns: auto 1fr 1fr; }
        }
    </style>
</head>
<body>
    <!-- Fullscreen Container -->
    <div class="fullscreen-board-container" id="fullscreenContainer">
        <div class="fullscreen-board" id="fullscreenBoard"></div>
    </div>
    
    <!-- Editor -->
    <div class="editor-container">
        <div class="page-header">
            <h1 class="page-title">ğŸšƒ <span>æ™‚é–“å‰²è¡¨ç¤ºæ¿</span> ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼</h1>
            <button class="fullscreen-btn" onclick="enterFullscreen()">ğŸ–¥ï¸ å…¨ç”»é¢è¡¨ç¤º</button>
        </div>
        
        <!-- Main Tabs -->
        <div class="main-tabs">
            <button class="main-tab active" onclick="switchMainTab('basic')">åŸºæœ¬è¨­å®š</button>
            <button class="main-tab" onclick="switchMainTab('schedule')">æ™‚é–“å‰²</button>
            <button class="main-tab" onclick="switchMainTab('holiday')">é•·æœŸä¼‘ã¿</button>
            <button class="main-tab" onclick="switchMainTab('announce')">ãŠçŸ¥ã‚‰ã›</button>
        </div>
        
        <!-- Basic Settings Tab -->
        <div id="tab-basic" class="tab-content active">
            <div class="section-title">ğŸ“‹ åŸºæœ¬è¨­å®š</div>
            <div class="editor-grid">
                <div class="form-group">
                    <label>è¡¨ç¤ºåï¼ˆå·¦ä¸Šãƒ©ãƒ™ãƒ«ï¼‰</label>
                    <input type="text" id="displayName" value="æ™® é€š" oninput="updateBoard()">
                </div>
                <div class="form-group">
                    <label>ã‚¯ãƒ©ã‚¹ç•ªå·</label>
                    <input type="text" id="classNum" value="3" oninput="updateBoard()">
                </div>
                <div class="form-group">
                    <label>ã‚¯ãƒ©ã‚¹å˜ä½</label>
                    <input type="text" id="classUnit" value="çµ„" oninput="updateBoard()">
                </div>
                <div class="form-group">
                    <label>ä¼‘æ†©æ™‚é–“ï¼ˆåˆ†ï¼‰</label>
                    <input type="number" id="breakMinutes" value="10" min="1" max="60" oninput="updateBoard()">
                </div>
            </div>
            
            <div class="section-title">âš™ï¸ ãƒ•ãƒƒã‚¿ãƒ¼è¨­å®š</div>
            <div class="form-group">
                <label>é€šå¸¸æ™‚ã®ãƒ•ãƒƒã‚¿ãƒ¼</label>
                <input type="text" id="footerMsg" value="ç§»å‹•ã€æº–å‚™æ™‚é–“ã¯å«ã¾ã‚Œã¾ã›ã‚“ã€‚æˆæ¥­ã«ã‚ˆã‚Šå¤šå°‘æ™‚é–“ãŒç•°ãªã‚Šã¾ã™ã€‚" oninput="updateBoard()" style="width:100%">
            </div>
            
            <div class="section-title">ğŸŒ™ çµ‚äº†å¾Œã®è¡¨ç¤º</div>
            <div class="editor-grid">
                <div class="form-group">
                    <label>çµ‚äº†å¾Œã®ã‚¿ã‚¤ãƒˆãƒ«</label>
                    <input type="text" id="endTitle" value="æœ¬æ—¥çµ‚äº†" oninput="updateBoard()">
                </div>
                <div class="form-group">
                    <label>çµ‚äº†å¾Œã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</label>
                    <input type="text" id="endMessage" value="æœ¬æ—¥ã®æˆæ¥­ã¯å…¨ã¦çµ‚äº†ã—ã¾ã—ãŸã€‚" oninput="updateBoard()">
                </div>
                <div class="form-group">
                    <label>çµ‚äº†å¾Œã®ãƒ•ãƒƒã‚¿ãƒ¼</label>
                    <input type="text" id="endFooterMsg" value="ã¾ãŸæ˜æ—¥ãŠä¼šã„ã—ã¾ã—ã‚‡ã†ã€‚" oninput="updateBoard()">
                </div>
            </div>
            
            <div class="button-row">
                <button class="btn btn-save" onclick="saveData()">ğŸ’¾ ä¿å­˜</button>
                <button class="btn btn-load" onclick="loadData()">ğŸ“‚ èª­è¾¼</button>
                <button class="btn btn-reset" onclick="resetData()">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
            </div>
        </div>
        
        <!-- Schedule Tab -->
        <div id="tab-schedule" class="tab-content">
            <div class="section-title">ğŸ“… æ—¥èª²ã‚¿ã‚¤ãƒ—é¸æŠ</div>
            <div class="schedule-type-tabs" id="scheduleTypeTabs"></div>
            <button class="add-btn" onclick="addScheduleType()" style="margin-bottom:20px;">ï¼‹ æ—¥èª²ã‚¿ã‚¤ãƒ—ã‚’è¿½åŠ </button>
            
            <div class="section-title">ğŸ“… æ›œæ—¥åˆ¥ã®æ—¥èª²ã‚¿ã‚¤ãƒ—è¨­å®š</div>
            <div class="editor-grid" id="dayScheduleTypeGrid"></div>
            
            <div class="section-title">ğŸ“š æ™‚é–“å‰²ç·¨é›†</div>
            <div class="day-tabs" id="dayTabs"></div>
            <div class="period-list" id="periodList"></div>
            <button class="add-btn" onclick="addPeriod()">ï¼‹ æ™‚é™ã‚’è¿½åŠ </button>
        </div>
        
        <!-- Holiday Tab -->
        <div id="tab-holiday" class="tab-content">
            <div class="section-title">ğŸŒ ç¥æ—¥è‡ªå‹•æ¤œå‡º</div>
            <div class="editor-grid">
                <div class="form-group">
                    <label>æ—¥æœ¬ã®ç¥æ—¥ã‚’è‡ªå‹•ã§ä¼‘ã¿è¡¨ç¤º</label>
                    <select id="autoNationalHoliday" onchange="updateBoard()">
                        <option value="1">æœ‰åŠ¹</option>
                        <option value="0">ç„¡åŠ¹</option>
                    </select>
                </div>
            </div>
            <p style="color:#666; margin-bottom:15px; font-size:13px;">â€»å…ƒæ—¥ã€æˆäººã®æ—¥ã€å»ºå›½è¨˜å¿µã®æ—¥ã€å¤©çš‡èª•ç”Ÿæ—¥ã€æ˜¥åˆ†ã®æ—¥ã€æ˜­å’Œã®æ—¥ã€æ†²æ³•è¨˜å¿µæ—¥ã€ã¿ã©ã‚Šã®æ—¥ã€ã“ã©ã‚‚ã®æ—¥ã€æµ·ã®æ—¥ã€å±±ã®æ—¥ã€æ•¬è€ã®æ—¥ã€ç§‹åˆ†ã®æ—¥ã€ã‚¹ãƒãƒ¼ãƒ„ã®æ—¥ã€æ–‡åŒ–ã®æ—¥ã€å‹¤åŠ´æ„Ÿè¬ã®æ—¥ã€æŒ¯æ›¿ä¼‘æ—¥ã«å¯¾å¿œ</p>
            
            <div class="section-title" style="margin-top:20px;">ğŸ–ï¸ é•·æœŸä¼‘ã¿è¨­å®š</div>
            <p style="color:#666; margin-bottom:15px;">ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ã¨ã€ãã®æœŸé–“ã¯ä¼‘ã¿è¡¨ç¤ºã«ãªã‚Šã¾ã™ã€‚</p>
            <div id="holidayList"></div>
            <button class="add-btn" onclick="addHoliday()">ï¼‹ ä¼‘ã¿æœŸé–“ã‚’è¿½åŠ </button>
            
            <div class="section-title" style="margin-top:30px;">ğŸ‰ ä¼‘ã¿ãƒ»ç¥æ—¥ä¸­ã®è¡¨ç¤º</div>
            <div class="editor-grid">
                <div class="form-group">
                    <label>é•·æœŸä¼‘ã¿ä¸­ã®ã‚¿ã‚¤ãƒˆãƒ«</label>
                    <input type="text" id="holidayTitle" value="é•·æœŸä¼‘ã¿ä¸­" oninput="updateBoard()">
                </div>
                <div class="form-group">
                    <label>é•·æœŸä¼‘ã¿ä¸­ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</label>
                    <input type="text" id="holidayMessage" value="ã‚†ã£ãã‚Šä¼‘ã‚“ã§ã­ï¼" oninput="updateBoard()">
                </div>
                <div class="form-group">
                    <label>é•·æœŸä¼‘ã¿ä¸­ã®ãƒ•ãƒƒã‚¿ãƒ¼</label>
                    <input type="text" id="holidayFooterMsg" value="æ¬¡ã®ç™»æ ¡æ—¥ã‚’ãŠæ¥½ã—ã¿ã«ï¼" oninput="updateBoard()">
                </div>
            </div>
            <div class="editor-grid" style="margin-top:15px;">
                <div class="form-group">
                    <label>ç¥æ—¥ã®ã‚¿ã‚¤ãƒˆãƒ«</label>
                    <input type="text" id="nationalHolidayTitle" value="æœ¬æ—¥ã¯ç¥æ—¥ã§ã™" oninput="updateBoard()">
                </div>
                <div class="form-group">
                    <label>ç¥æ—¥ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</label>
                    <input type="text" id="nationalHolidayMessage" value="ã‚†ã£ãã‚ŠãŠä¼‘ã¿ãã ã•ã„" oninput="updateBoard()">
                </div>
                <div class="form-group">
                    <label>ç¥æ—¥ã®ãƒ•ãƒƒã‚¿ãƒ¼</label>
                    <input type="text" id="nationalHolidayFooterMsg" value="æ¬¡ã®ç™»æ ¡æ—¥ã«ä¼šã„ã¾ã—ã‚‡ã†ï¼" oninput="updateBoard()">
                </div>
            </div>
        </div>
        
        <!-- Announcement Tab -->
        <div id="tab-announce" class="tab-content">
            <div class="section-title">ğŸ“¢ ãŠçŸ¥ã‚‰ã›è¨­å®š</div>
            <div class="form-group">
                <label>ãŠçŸ¥ã‚‰ã›ã‚’è¡¨ç¤ºã™ã‚‹</label>
                <select id="showAnnouncement" onchange="updateBoard()">
                    <option value="0">è¡¨ç¤ºã—ãªã„</option>
                    <option value="1">è¡¨ç¤ºã™ã‚‹</option>
                </select>
            </div>
            <div class="form-group" style="margin-top:15px;">
                <label>ãŠçŸ¥ã‚‰ã›å†…å®¹ï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰</label>
                <textarea id="announcementText" rows="3" oninput="updateBoard()" style="width:100%">æœ¬æ—¥ã®æ”¾èª²å¾Œã€ä½“è‚²é¤¨ã§å…¨æ ¡é›†ä¼šãŒã‚ã‚Šã¾ã™ã€‚å…¨å“¡å‚åŠ ã—ã¦ãã ã•ã„ã€‚</textarea>
            </div>
        </div>
        
        <div class="preview-label">â–¼ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</div>
        <div class="board-preview" id="previewBoard"></div>
    </div>
    
    <script>
        const dayNames = ['æœˆæ›œ', 'ç«æ›œ', 'æ°´æ›œ', 'æœ¨æ›œ', 'é‡‘æ›œ', 'åœŸæ›œ', 'æ—¥æ›œ'];
        const dayDisplay = ['æœˆ æ›œ', 'ç« æ›œ', 'æ°´ æ›œ', 'æœ¨ æ›œ', 'é‡‘ æ›œ', 'åœŸ æ›œ', 'æ—¥ æ›œ'];
        
        let config = {
            displayName: 'æ™® é€š',
            classNum: '3',
            classUnit: 'çµ„',
            breakMinutes: 10,
            footerMsg: 'ç§»å‹•ã€æº–å‚™æ™‚é–“ã¯å«ã¾ã‚Œã¾ã›ã‚“ã€‚æˆæ¥­ã«ã‚ˆã‚Šå¤šå°‘æ™‚é–“ãŒç•°ãªã‚Šã¾ã™ã€‚',
            endTitle: 'æœ¬æ—¥çµ‚äº†',
            endMessage: 'æœ¬æ—¥ã®æˆæ¥­ã¯å…¨ã¦çµ‚äº†ã—ã¾ã—ãŸã€‚',
            endFooterMsg: 'ã¾ãŸæ˜æ—¥ãŠä¼šã„ã—ã¾ã—ã‚‡ã†ã€‚',
            holidayTitle: 'é•·æœŸä¼‘ã¿ä¸­',
            holidayMessage: 'ã‚†ã£ãã‚Šä¼‘ã‚“ã§ã­ï¼',
            holidayFooterMsg: 'æ¬¡ã®ç™»æ ¡æ—¥ã‚’ãŠæ¥½ã—ã¿ã«ï¼',
            autoNationalHoliday: true,
            nationalHolidayTitle: 'æœ¬æ—¥ã¯ç¥æ—¥ã§ã™',
            nationalHolidayMessage: 'ã‚†ã£ãã‚ŠãŠä¼‘ã¿ãã ã•ã„',
            nationalHolidayFooterMsg: 'æ¬¡ã®ç™»æ ¡æ—¥ã«ä¼šã„ã¾ã—ã‚‡ã†ï¼',
            showAnnouncement: false,
            announcementText: 'æœ¬æ—¥ã®æ”¾èª²å¾Œã€ä½“è‚²é¤¨ã§å…¨æ ¡é›†ä¼šãŒã‚ã‚Šã¾ã™ã€‚',
            scheduleTypes: ['é€šå¸¸', 'çŸ­ç¸®', 'ç‰¹åˆ¥'],
            currentScheduleType: 'é€šå¸¸',
            dayScheduleTypes: ['é€šå¸¸', 'é€šå¸¸', 'é€šå¸¸', 'é€šå¸¸', 'é€šå¸¸', 'é€šå¸¸', 'é€šå¸¸'],
            holidays: [],
            schedules: {}
        };
        
        let currentEditDay = 0;
        let currentEditScheduleType = 'é€šå¸¸';
        
        function initDefaultSchedule() {
            const defaultPeriods = [
                { label: 'æœHR', start: '08:30', end: '08:40', isHR: true },
                { label: '1', start: '08:50', end: '09:40' },
                { label: '2', start: '09:50', end: '10:40' },
                { label: '3', start: '10:50', end: '11:40' },
                { label: '4', start: '11:50', end: '12:40' },
                { label: '5', start: '13:30', end: '14:20' },
                { label: '6', start: '14:30', end: '15:20' },
                { label: 'HR', start: '15:25', end: '15:35', isHR: true }
            ];
            
            const shortPeriods = [
                { label: 'æœHR', start: '08:30', end: '08:35', isHR: true },
                { label: '1', start: '08:40', end: '09:20' },
                { label: '2', start: '09:30', end: '10:10' },
                { label: '3', start: '10:20', end: '11:00' },
                { label: '4', start: '11:10', end: '11:50' },
                { label: 'HR', start: '11:55', end: '12:05', isHR: true }
            ];
            
            const defaultSubjects = [
                ['æœHR', 'å›½èª', 'æ•°å­¦I', 'è‹±èªC1', 'ä½“è‚²', 'åŒ–å­¦åŸºç¤', 'åœ°ç†ç·åˆ', 'HR'],
                ['æœHR', 'åŒ–å­¦åŸºç¤', 'ä½“è‚²', 'è‹±èªC1', 'ç¾ä»£å›½èª', 'æ•°å­¦I', 'åœ°ç†ç·åˆ', 'HR'],
                ['æœHR', 'æ•°å­¦I', 'ç¾ä»£å›½èª', 'ä½“è‚²', 'è‹±èªC1', 'æƒ…å ±I', 'åŒ–å­¦åŸºç¤', 'HR'],
                ['æœHR', 'è‹±èªC1', 'åœ°ç†ç·åˆ', 'æ•°å­¦I', 'å›½èª', 'ä½“è‚²', 'éŸ³æ¥½', 'HR'],
                ['æœHR', 'åŒ–å­¦åŸºç¤', 'è‹±èªC1', 'ç¾ä»£å›½èª', 'æ•°å­¦I', 'ç·åˆ', 'LHR', 'HR'],
                ['æœHR', 'æ•°å­¦I', 'è‹±èªC1', 'å›½èª', '', '', '', 'HR'],
                ['', '', '', '', '', '', '', '']
            ];
            
            const defaultRooms = [
                ['', '', '', '', '1Fä½“è‚²é¤¨', '3Fç†ç§‘å®¤', '', ''],
                ['', '3Fç†ç§‘å®¤', '1Fä½“è‚²é¤¨', '', '', '', '', ''],
                ['', '', '', '1Fä½“è‚²é¤¨', '', '2FPCå®¤', '3Fç†ç§‘å®¤', ''],
                ['', '', '', '', '', '1Fä½“è‚²é¤¨', '4FéŸ³æ¥½å®¤', ''],
                ['', '3Fç†ç§‘å®¤', '', '', '', '', '', ''],
                ['', '', '', '', '', '', '', ''],
                ['', '', '', '', '', '', '', '']
            ];
            
            config.schedules = {};
            
            // é€šå¸¸æ—¥èª²
            config.schedules['é€šå¸¸'] = [];
            for (let d = 0; d < 7; d++) {
                const daySchedule = [];
                for (let p = 0; p < defaultPeriods.length; p++) {
                    daySchedule.push({
                        ...defaultPeriods[p],
                        subject: defaultSubjects[d][p] || '',
                        room: defaultRooms[d][p] || ''
                    });
                }
                config.schedules['é€šå¸¸'].push(daySchedule);
            }
            
            // çŸ­ç¸®æ—¥èª²
            config.schedules['çŸ­ç¸®'] = [];
            for (let d = 0; d < 7; d++) {
                const daySchedule = [];
                for (let p = 0; p < shortPeriods.length; p++) {
                    daySchedule.push({
                        ...shortPeriods[p],
                        subject: defaultSubjects[d][p] || '',
                        room: ''
                    });
                }
                config.schedules['çŸ­ç¸®'].push(daySchedule);
            }
            
            // ç‰¹åˆ¥æ—¥èª²
            config.schedules['ç‰¹åˆ¥'] = JSON.parse(JSON.stringify(config.schedules['é€šå¸¸']));
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            initDefaultSchedule();
            loadFromStorage();
            renderAll();
            updateBoard();
            setInterval(updateBoard, 1000);
            
            document.addEventListener('fullscreenchange', handleFullscreenChange);
            document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
        });
        
        function handleFullscreenChange() {
            const isFs = !!(document.fullscreenElement || document.webkitFullscreenElement);
            document.body.classList.toggle('fullscreen-mode', isFs);
            updateBoard();
        }
        
        function enterFullscreen() {
            const el = document.getElementById('fullscreenContainer');
            if (el.requestFullscreen) el.requestFullscreen();
            else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
        }
        
        function switchMainTab(name) {
            document.querySelectorAll('.main-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('tab-' + name).classList.add('active');
        }
        
        function renderAll() {
            renderScheduleTypeTabs();
            renderDayScheduleTypeGrid();
            renderDayTabs();
            renderPeriodList();
            renderHolidayList();
        }
        
        function renderScheduleTypeTabs() {
            const container = document.getElementById('scheduleTypeTabs');
            container.innerHTML = config.scheduleTypes.map(type =>
                `<button class="schedule-type-tab ${type === currentEditScheduleType ? 'active' : ''}" onclick="switchScheduleType('${type}')">${type}</button>`
            ).join('');
        }
        
        function switchScheduleType(type) {
            currentEditScheduleType = type;
            renderScheduleTypeTabs();
            renderPeriodList();
        }
        
        function addScheduleType() {
            const name = prompt('æ–°ã—ã„æ—¥èª²ã‚¿ã‚¤ãƒ—åã‚’å…¥åŠ›:');
            if (name && !config.scheduleTypes.includes(name)) {
                config.scheduleTypes.push(name);
                config.schedules[name] = JSON.parse(JSON.stringify(config.schedules['é€šå¸¸']));
                renderAll();
            }
        }
        
        function renderDayScheduleTypeGrid() {
            const container = document.getElementById('dayScheduleTypeGrid');
            container.innerHTML = dayNames.map((day, i) => `
                <div class="form-group">
                    <label>${day}ã®æ—¥èª²</label>
                    <select onchange="config.dayScheduleTypes[${i}] = this.value; updateBoard()">
                        ${config.scheduleTypes.map(t => `<option value="${t}" ${config.dayScheduleTypes[i] === t ? 'selected' : ''}>${t}</option>`).join('')}
                    </select>
                </div>
            `).join('');
        }
        
        function renderDayTabs() {
            const container = document.getElementById('dayTabs');
            container.innerHTML = dayNames.map((name, i) =>
                `<button class="day-tab ${i === currentEditDay ? 'active' : ''}" onclick="switchEditDay(${i})">${name}</button>`
            ).join('');
        }
        
        function switchEditDay(day) {
            currentEditDay = day;
            renderDayTabs();
            renderPeriodList();
        }
        
        function renderPeriodList() {
            const container = document.getElementById('periodList');
            if (!config.schedules[currentEditScheduleType]) {
                config.schedules[currentEditScheduleType] = JSON.parse(JSON.stringify(config.schedules['é€šå¸¸']));
            }
            const daySchedule = config.schedules[currentEditScheduleType][currentEditDay];
            
            container.innerHTML = daySchedule.map((p, i) => `
                <div class="period-item">
                    <input type="text" class="label-input" value="${p.label}" onchange="updatePeriod(${i}, 'label', this.value)">
                    <input type="time" value="${p.start}" onchange="updatePeriod(${i}, 'start', this.value)">
                    <input type="time" value="${p.end}" onchange="updatePeriod(${i}, 'end', this.value)">
                    <input type="text" value="${p.subject}" onchange="updatePeriod(${i}, 'subject', this.value)" placeholder="ç§‘ç›®">
                    <input type="text" value="${p.room}" onchange="updatePeriod(${i}, 'room', this.value)" placeholder="æ•™å®¤">
                    <button class="delete-btn" onclick="deletePeriod(${i})">Ã—</button>
                </div>
            `).join('');
        }
        
        function updatePeriod(index, field, value) {
            config.schedules[currentEditScheduleType][currentEditDay][index][field] = value;
            if (field === 'label') {
                config.schedules[currentEditScheduleType][currentEditDay][index].isHR = value.includes('HR');
            }
            updateBoard();
        }
        
        function addPeriod() {
            const daySchedule = config.schedules[currentEditScheduleType][currentEditDay];
            const last = daySchedule[daySchedule.length - 1];
            let newStart = '09:00', newEnd = '09:50';
            if (last) {
                const endMin = timeToMinutes(last.end) + 10;
                newStart = minutesToTime(endMin);
                newEnd = minutesToTime(endMin + 50);
            }
            const nums = daySchedule.map(p => parseInt(p.label)).filter(n => !isNaN(n));
            const nextNum = nums.length > 0 ? Math.max(...nums) + 1 : 1;
            daySchedule.push({ label: String(nextNum), start: newStart, end: newEnd, subject: '', room: '', isHR: false });
            renderPeriodList();
            updateBoard();
        }
        
        function deletePeriod(index) {
            const daySchedule = config.schedules[currentEditScheduleType][currentEditDay];
            if (daySchedule.length > 1) {
                daySchedule.splice(index, 1);
                renderPeriodList();
                updateBoard();
            }
        }
        
        function renderHolidayList() {
            const container = document.getElementById('holidayList');
            container.innerHTML = config.holidays.map((h, i) => `
                <div class="holiday-item">
                    <input type="checkbox" ${h.enabled ? 'checked' : ''} onchange="config.holidays[${i}].enabled = this.checked; updateBoard()">
                    <input type="date" value="${h.start}" onchange="config.holidays[${i}].start = this.value; updateBoard()">
                    <input type="date" value="${h.end}" onchange="config.holidays[${i}].end = this.value; updateBoard()">
                    <input type="text" value="${h.name}" onchange="config.holidays[${i}].name = this.value; updateBoard()" placeholder="ä¼‘ã¿åï¼ˆå¤ä¼‘ã¿ãªã©ï¼‰">
                    <button class="delete-btn" onclick="deleteHoliday(${i})">Ã—</button>
                </div>
            `).join('');
        }
        
        function addHoliday() {
            const today = new Date().toISOString().split('T')[0];
            config.holidays.push({ enabled: true, start: today, end: today, name: 'æ–°ã—ã„ä¼‘ã¿' });
            renderHolidayList();
        }
        
        function deleteHoliday(index) {
            config.holidays.splice(index, 1);
            renderHolidayList();
            updateBoard();
        }
        
        function timeToMinutes(t) {
            if (!t) return 0;
            const [h, m] = t.split(':').map(Number);
            return h * 60 + m;
        }
        
        function minutesToTime(m) {
            return `${String(Math.floor(m / 60)).padStart(2, '0')}:${String(m % 60).padStart(2, '0')}`;
        }
        
        function isHoliday(date) {
            const dateStr = date.toISOString().split('T')[0];
            return config.holidays.some(h => h.enabled && dateStr >= h.start && dateStr <= h.end);
        }
        
        function getCurrentHolidayName(date) {
            const dateStr = date.toISOString().split('T')[0];
            const holiday = config.holidays.find(h => h.enabled && dateStr >= h.start && dateStr <= h.end);
            return holiday ? holiday.name : '';
        }
        
        // Japanese National Holiday Detection
        function getNthWeekday(year, month, nth, weekday) {
            // Get nth weekday of month (weekday: 0=Sun, 1=Mon, etc.)
            const first = new Date(year, month, 1);
            const firstWeekday = first.getDay();
            let day = 1 + (weekday - firstWeekday + 7) % 7 + (nth - 1) * 7;
            return new Date(year, month, day);
        }
        
        function getSpringEquinox(year) {
            // Approximate spring equinox for Japan
            const day = Math.floor(20.8431 + 0.242194 * (year - 1980) - Math.floor((year - 1980) / 4));
            return new Date(year, 2, day); // March
        }
        
        function getAutumnEquinox(year) {
            // Approximate autumn equinox for Japan
            const day = Math.floor(23.2488 + 0.242194 * (year - 1980) - Math.floor((year - 1980) / 4));
            return new Date(year, 8, day); // September
        }
        
        function getJapaneseHolidays(year) {
            const holidays = [];
            
            // Fixed holidays
            holidays.push({ date: new Date(year, 0, 1), name: 'å…ƒæ—¥' });
            holidays.push({ date: new Date(year, 1, 11), name: 'å»ºå›½è¨˜å¿µã®æ—¥' });
            holidays.push({ date: new Date(year, 1, 23), name: 'å¤©çš‡èª•ç”Ÿæ—¥' });
            holidays.push({ date: new Date(year, 3, 29), name: 'æ˜­å’Œã®æ—¥' });
            holidays.push({ date: new Date(year, 4, 3), name: 'æ†²æ³•è¨˜å¿µæ—¥' });
            holidays.push({ date: new Date(year, 4, 4), name: 'ã¿ã©ã‚Šã®æ—¥' });
            holidays.push({ date: new Date(year, 4, 5), name: 'ã“ã©ã‚‚ã®æ—¥' });
            holidays.push({ date: new Date(year, 7, 11), name: 'å±±ã®æ—¥' });
            holidays.push({ date: new Date(year, 10, 3), name: 'æ–‡åŒ–ã®æ—¥' });
            holidays.push({ date: new Date(year, 10, 23), name: 'å‹¤åŠ´æ„Ÿè¬ã®æ—¥' });
            
            // Happy Monday holidays
            holidays.push({ date: getNthWeekday(year, 0, 2, 1), name: 'æˆäººã®æ—¥' }); // 2nd Monday Jan
            holidays.push({ date: getNthWeekday(year, 6, 3, 1), name: 'æµ·ã®æ—¥' }); // 3rd Monday Jul
            holidays.push({ date: getNthWeekday(year, 8, 3, 1), name: 'æ•¬è€ã®æ—¥' }); // 3rd Monday Sep
            holidays.push({ date: getNthWeekday(year, 9, 2, 1), name: 'ã‚¹ãƒãƒ¼ãƒ„ã®æ—¥' }); // 2nd Monday Oct
            
            // Equinoxes
            holidays.push({ date: getSpringEquinox(year), name: 'æ˜¥åˆ†ã®æ—¥' });
            holidays.push({ date: getAutumnEquinox(year), name: 'ç§‹åˆ†ã®æ—¥' });
            
            // Calculate substitute holidays (æŒ¯æ›¿ä¼‘æ—¥)
            const substituteHolidays = [];
            for (const h of holidays) {
                if (h.date.getDay() === 0) { // Sunday
                    const substitute = new Date(h.date);
                    substitute.setDate(substitute.getDate() + 1);
                    // Check if next day is also a holiday
                    while (holidays.some(hh => hh.date.getTime() === substitute.getTime()) ||
                           substituteHolidays.some(sh => sh.date.getTime() === substitute.getTime())) {
                        substitute.setDate(substitute.getDate() + 1);
                    }
                    substituteHolidays.push({ date: substitute, name: 'æŒ¯æ›¿ä¼‘æ—¥' });
                }
            }
            
            return [...holidays, ...substituteHolidays];
        }
        
        function getNationalHoliday(date) {
            if (!config.autoNationalHoliday) return null;
            
            const year = date.getFullYear();
            const holidays = getJapaneseHolidays(year);
            
            const dateStr = date.toDateString();
            const found = holidays.find(h => h.date.toDateString() === dateStr);
            return found || null;
        }
        
        function getCurrentTimeInfo() {
            const now = new Date();
            const timeStr = `${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}`;
            const dayOfWeek = now.getDay();
            const adjustedDay = dayOfWeek === 0 ? 6 : dayOfWeek - 1;
            const currentMinutes = now.getHours() * 60 + now.getMinutes();
            
            // Long holiday check (user-defined)
            if (isHoliday(now)) {
                return { 
                    time: timeStr, 
                    day: adjustedDay, 
                    isHoliday: true, 
                    isNationalHoliday: false,
                    holidayName: getCurrentHolidayName(now) 
                };
            }
            
            // National holiday check (auto-detected)
            const nationalHoliday = getNationalHoliday(now);
            if (nationalHoliday) {
                return {
                    time: timeStr,
                    day: adjustedDay,
                    isHoliday: false,
                    isNationalHoliday: true,
                    nationalHolidayName: nationalHoliday.name
                };
            }
            
            const scheduleType = config.dayScheduleTypes[adjustedDay];
            const daySchedule = config.schedules[scheduleType]?.[adjustedDay] || [];
            
            let currentPeriod = -1;
            let periodProgress = 0;
            let isEnded = false;
            let isBreak = false;
            let breakRemaining = 0;
            let nextSubject = '';
            
            if (daySchedule.length > 0) {
                const firstStart = timeToMinutes(daySchedule[0].start);
                const lastEnd = timeToMinutes(daySchedule[daySchedule.length - 1].end);
                
                if (currentMinutes < firstStart) {
                    currentPeriod = -1;
                } else if (currentMinutes >= lastEnd) {
                    isEnded = true;
                } else {
                    for (let i = 0; i < daySchedule.length; i++) {
                        const startMin = timeToMinutes(daySchedule[i].start);
                        const endMin = timeToMinutes(daySchedule[i].end);
                        
                        if (currentMinutes >= startMin && currentMinutes < endMin) {
                            currentPeriod = i;
                            periodProgress = (currentMinutes - startMin) / (endMin - startMin);
                            break;
                        } else if (i < daySchedule.length - 1) {
                            const nextStart = timeToMinutes(daySchedule[i + 1].start);
                            if (currentMinutes >= endMin && currentMinutes < nextStart) {
                                isBreak = true;
                                breakRemaining = nextStart - currentMinutes;
                                nextSubject = daySchedule[i + 1].subject || 'æ¬¡ã®æˆæ¥­';
                                currentPeriod = i;
                                break;
                            }
                        }
                    }
                }
            }
            
            return {
                time: timeStr,
                day: adjustedDay,
                scheduleType,
                period: currentPeriod,
                progress: periodProgress,
                isEnded,
                isBreak,
                breakRemaining,
                nextSubject,
                isHoliday: false
            };
        }
        
        function generateBoardHTML(timeInfo) {
            readConfigFromInputs();
            
            const day = timeInfo.day;
            const showAnnounce = config.showAnnouncement && !timeInfo.isHoliday && !timeInfo.isNationalHoliday && !timeInfo.isEnded;
            
            // Long holiday display (user-defined)
            if (timeInfo.isHoliday) {
                return `
                    <div class="board-header">
                        <div class="train-type-badge">${config.displayName}</div>
                        <div class="header-right">
                            <div class="time-section">
                                <span class="time-label">ç¾åœ¨æ™‚åˆ»</span>
                                <span class="time-value">${timeInfo.time}</span>
                            </div>
                            <div class="class-badge">
                                <div class="class-number-box"><span class="class-number-value">${config.classNum}</span></div>
                                <span class="class-unit">${config.classUnit}</span>
                            </div>
                        </div>
                    </div>
                    <div class="main-display">
                        <div class="day-section">
                            <div class="day-display">${dayDisplay[day]}</div>
                            <div class="schedule-type-display">${timeInfo.holidayName || 'ä¼‘ã¿'}</div>
                        </div>
                        <div class="special-display">
                            <div class="special-title">${config.holidayTitle}</div>
                            <div class="special-message">${config.holidayMessage}</div>
                        </div>
                    </div>
                    <div class="board-footer"><p class="footer-message">${config.holidayFooterMsg}</p></div>
                `;
            }
            
            // National holiday display (auto-detected)
            if (timeInfo.isNationalHoliday) {
                return `
                    <div class="board-header">
                        <div class="train-type-badge">${config.displayName}</div>
                        <div class="header-right">
                            <div class="time-section">
                                <span class="time-label">ç¾åœ¨æ™‚åˆ»</span>
                                <span class="time-value">${timeInfo.time}</span>
                            </div>
                            <div class="class-badge">
                                <div class="class-number-box"><span class="class-number-value">${config.classNum}</span></div>
                                <span class="class-unit">${config.classUnit}</span>
                            </div>
                        </div>
                    </div>
                    <div class="main-display">
                        <div class="day-section">
                            <div class="day-display">${dayDisplay[day]}</div>
                            <div class="schedule-type-display">${timeInfo.nationalHolidayName}</div>
                        </div>
                        <div class="special-display">
                            <div class="special-title">${config.nationalHolidayTitle}</div>
                            <div class="special-message">${config.nationalHolidayMessage}</div>
                        </div>
                    </div>
                    <div class="board-footer"><p class="footer-message">${config.nationalHolidayFooterMsg}</p></div>
                `;
            }
            
            // Ended display
            if (timeInfo.isEnded) {
                return `
                    <div class="board-header">
                        <div class="train-type-badge">${config.displayName}</div>
                        <div class="header-right">
                            <div class="time-section">
                                <span class="time-label">ç¾åœ¨æ™‚åˆ»</span>
                                <span class="time-value">${timeInfo.time}</span>
                            </div>
                            <div class="class-badge">
                                <div class="class-number-box"><span class="class-number-value">${config.classNum}</span></div>
                                <span class="class-unit">${config.classUnit}</span>
                            </div>
                        </div>
                    </div>
                    <div class="main-display">
                        <div class="day-section">
                            <div class="day-display">${dayDisplay[day]}</div>
                            <div class="schedule-type-display">${timeInfo.scheduleType}</div>
                        </div>
                        <div class="special-display">
                            <div class="special-title">${config.endTitle}</div>
                            <div class="special-message">${config.endMessage}</div>
                        </div>
                    </div>
                    <div class="board-footer"><p class="footer-message">${config.endFooterMsg}</p></div>
                `;
            }
            
            const scheduleType = timeInfo.scheduleType;
            const daySchedule = config.schedules[scheduleType]?.[day] || [];
            const period = timeInfo.period;
            
            let mainContent = '';
            
            if (timeInfo.isBreak) {
                // Break time with countdown
                const mins = Math.floor(timeInfo.breakRemaining);
                const secs = Math.floor((timeInfo.breakRemaining % 1) * 60);
                const timerClass = mins < 2 ? 'break-timer urgent' : 'break-timer';
                
                mainContent = `
                    <div class="break-timer-container">
                        <div class="break-timer-label">ğŸ”” ä¼‘æ†©ä¸­ - æ¬¡ã®æˆæ¥­ã¾ã§</div>
                        <div class="${timerClass}">${mins}:${String(secs).padStart(2, '0')}</div>
                        <div class="break-next-subject">æ¬¡ã¯ã€Œ${timeInfo.nextSubject}ã€</div>
                    </div>
                `;
            } else {
                let currentSubject = 'æˆæ¥­å‰';
                let periodDisplay = 'âˆ’';
                
                if (period >= 0 && period < daySchedule.length) {
                    currentSubject = daySchedule[period].subject || 'âˆ’';
                    periodDisplay = daySchedule[period].label || '';
                }
                
                mainContent = `
                    <div class="current-period-section">
                        <div class="period-indicator">
                            <span class="period-indicator-text">${periodDisplay}</span>
                        </div>
                        <div class="current-subject">${currentSubject}</div>
                    </div>
                `;
            }
            
            // Schedule grid
            let scheduleItems = '', timelineItems = '', roomItems = '';
            let progressWidth = 0;
            
            for (let i = 0; i < daySchedule.length; i++) {
                const p = daySchedule[i];
                const isHR = p.isHR || p.label.includes('HR');
                const isActive = period === i && !timeInfo.isBreak;
                const isPassed = period > i || (period === i && timeInfo.isBreak);
                const statusClass = isActive ? 'active' : (isPassed ? 'passed' : '');
                
                scheduleItems += `<div class="schedule-item ${isHR ? 'hr-slot' : ''}">${formatSubject(p.subject)}</div>`;
                
                if (isHR) {
                    timelineItems += `<div class="timeline-marker hr-slot"><div class="timeline-dot ${isPassed || isActive ? 'filled' : ''}"></div></div>`;
                } else {
                    timelineItems += `<div class="timeline-marker"><div class="period-circle ${statusClass}">${p.label}</div></div>`;
                }
                
                roomItems += `<span class="${isHR ? 'hr-slot' : ''}">${p.room}</span>`;
                
                if (isPassed) {
                    progressWidth = ((i + 1) / daySchedule.length) * 100;
                } else if (isActive) {
                    progressWidth = ((i + timeInfo.progress) / daySchedule.length) * 100;
                }
            }
            
            const announcementHTML = showAnnounce ? `
                <div class="announcement-section">
                    <div class="announcement-ticker">
                        <span class="announcement-label">ğŸ“¢ ãŠçŸ¥ã‚‰ã›</span>
                        <span class="announcement-text">${config.announcementText}</span>
                    </div>
                </div>
            ` : '';
            
            return `
                <div class="board-header">
                    <div class="train-type-badge">${config.displayName}</div>
                    <div class="next-label">æ¬¡ã¯</div>
                    <div class="header-right">
                        <div class="time-section">
                            <span class="time-label">ç¾åœ¨æ™‚åˆ»</span>
                            <span class="time-value">${timeInfo.time}</span>
                        </div>
                        <div class="class-badge">
                            <div class="class-number-box"><span class="class-number-value">${config.classNum}</span></div>
                            <span class="class-unit">${config.classUnit}</span>
                        </div>
                    </div>
                </div>
                <div class="main-display">
                    <div class="day-section">
                        <div class="day-display">${dayDisplay[day]}</div>
                        <div class="schedule-type-display">${scheduleType}</div>
                    </div>
                    ${mainContent}
                </div>
                <div class="schedule-grid-section">
                    <div class="schedule-grid">${scheduleItems}</div>
                </div>
                <div class="timeline-section">
                    <div class="timeline">
                        <div class="timeline-track"><div class="progress-fill" style="width:${progressWidth}%"></div></div>
                        ${timelineItems}
                    </div>
                </div>
                <div class="room-info-section">
                    <div class="room-grid">${roomItems}</div>
                </div>
                ${announcementHTML}
                <div class="board-footer"><p class="footer-message">${footerText}</p></div>
            `;
        }
        
        function readConfigFromInputs() {
            config.displayName = document.getElementById('displayName')?.value || config.displayName;
            config.classNum = document.getElementById('classNum')?.value || config.classNum;
            config.classUnit = document.getElementById('classUnit')?.value || config.classUnit;
            config.breakMinutes = parseInt(document.getElementById('breakMinutes')?.value) || 10;
            config.footerMsg = document.getElementById('footerMsg')?.value || config.footerMsg;
            config.endTitle = document.getElementById('endTitle')?.value || config.endTitle;
            config.endMessage = document.getElementById('endMessage')?.value || config.endMessage;
            config.endFooterMsg = document.getElementById('endFooterMsg')?.value || config.endFooterMsg;
            config.holidayTitle = document.getElementById('holidayTitle')?.value || config.holidayTitle;
            config.holidayMessage = document.getElementById('holidayMessage')?.value || config.holidayMessage;
            config.holidayFooterMsg = document.getElementById('holidayFooterMsg')?.value || config.holidayFooterMsg;
            config.autoNationalHoliday = document.getElementById('autoNationalHoliday')?.value === '1';
            config.nationalHolidayTitle = document.getElementById('nationalHolidayTitle')?.value || config.nationalHolidayTitle;
            config.nationalHolidayMessage = document.getElementById('nationalHolidayMessage')?.value || config.nationalHolidayMessage;
            config.nationalHolidayFooterMsg = document.getElementById('nationalHolidayFooterMsg')?.value || config.nationalHolidayFooterMsg;
            config.showAnnouncement = document.getElementById('showAnnouncement')?.value === '1';
            config.announcementText = document.getElementById('announcementText')?.value || config.announcementText;
        }
        
        function updateBoard() {
            const timeInfo = getCurrentTimeInfo();
            const html = generateBoardHTML(timeInfo);
            document.getElementById('previewBoard').innerHTML = html;
            document.getElementById('fullscreenBoard').innerHTML = html;
        }
        
        function formatSubject(subject) {
            if (!subject) return '';
            if (subject === 'æœHR') return '<span class="subject-char">æœ</span><span class="subject-char">H</span><span class="subject-char">R</span>';
            if (subject === 'HR' || subject === 'çµ‚HR') return '<span class="subject-char">H</span><span class="subject-char" style="margin-top:20px">R</span>';
            if (subject === 'LHR') return '<span class="subject-char">L</span><span class="subject-char">H</span><span class="subject-char">R</span>';
            
            let result = '';
            if (subject.length <= 2) {
                for (let c of subject) result += `<span class="subject-char">${c}</span>`;
            } else if (subject.length <= 4) {
                for (let i = 0; i < subject.length; i += 2) result += `<span class="subject-char">${subject.slice(i, i+2)}</span>`;
            } else {
                result += `<span class="subject-char">${subject.slice(0,2)}</span><span class="subject-char">${subject.slice(2,4)}</span>`;
                if (subject.length > 4) result += `<span class="subject-char" style="font-size:18px">${subject.slice(4)}</span>`;
            }
            return result;
        }
        
        function saveData() {
            readConfigFromInputs();
            const dataStr = JSON.stringify(config, null, 2);
            localStorage.setItem('scheduleConfigV6', dataStr);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = 'schedule_config.json'; a.click();
            URL.revokeObjectURL(url);
            alert('âœ… ä¿å­˜ã—ã¾ã—ãŸï¼');
        }
        
        function loadData() {
            const input = document.createElement('input');
            input.type = 'file'; input.accept = '.json';
            input.onchange = (e) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        config = JSON.parse(e.target.result);
                        applyConfig();
                        alert('âœ… èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼');
                    } catch (err) { alert('âŒ ã‚¨ãƒ©ãƒ¼'); }
                };
                reader.readAsText(e.target.files[0]);
            };
            input.click();
        }
        
        function loadFromStorage() {
            const saved = localStorage.getItem('scheduleConfigV6');
            if (saved) {
                try { config = JSON.parse(saved); applyConfig(); } catch (err) {}
            }
        }
        
        function applyConfig() {
            document.getElementById('displayName').value = config.displayName || 'æ™® é€š';
            document.getElementById('classNum').value = config.classNum || '3';
            document.getElementById('classUnit').value = config.classUnit || 'çµ„';
            document.getElementById('breakMinutes').value = config.breakMinutes || 10;
            document.getElementById('footerMsg').value = config.footerMsg || '';
            document.getElementById('endTitle').value = config.endTitle || 'æœ¬æ—¥çµ‚äº†';
            document.getElementById('endMessage').value = config.endMessage || '';
            document.getElementById('endFooterMsg').value = config.endFooterMsg || '';
            document.getElementById('holidayTitle').value = config.holidayTitle || 'é•·æœŸä¼‘ã¿ä¸­';
            document.getElementById('holidayMessage').value = config.holidayMessage || '';
            document.getElementById('holidayFooterMsg').value = config.holidayFooterMsg || '';
            document.getElementById('autoNationalHoliday').value = config.autoNationalHoliday ? '1' : '0';
            document.getElementById('nationalHolidayTitle').value = config.nationalHolidayTitle || 'æœ¬æ—¥ã¯ç¥æ—¥ã§ã™';
            document.getElementById('nationalHolidayMessage').value = config.nationalHolidayMessage || '';
            document.getElementById('nationalHolidayFooterMsg').value = config.nationalHolidayFooterMsg || '';
            document.getElementById('showAnnouncement').value = config.showAnnouncement ? '1' : '0';
            document.getElementById('announcementText').value = config.announcementText || '';
            renderAll();
            updateBoard();
        }
        
        function resetData() {
            if (confirm('âš ï¸ å…¨ã¦ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                localStorage.removeItem('scheduleConfigV6');
                location.reload();
            }
        }
    </script>
</body>
</html>
